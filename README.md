
<p>
<a href="https://console.tiyaro.ai/explore?q=hfl/&pub=hfl"> <img src="https://tiyaro-public-docs.s3.us-west-2.amazonaws.com/assets/try_on_tiyaro_badge.svg"></a>
</p>

[**ä¸­æ–‡è¯´æ˜**](./README.md) | [**English**](./README_EN.md)

<p align="center">
    <br>
    <img src="./pics/banner.png" width="500"/>
    <br>
</p>
<p align="center">
    <a href="https://github.com/ymcui/Chinese-PreTrained-XLNet/blob/master/LICENSE">
        <img alt="GitHub" src="https://img.shields.io/github/license/ymcui/Chinese-PreTrained-XLNet.svg?color=blue&style=flat-square">
    </a>
</p>

æœ¬é¡¹ç›®æä¾›äº†é¢å‘ä¸­æ–‡çš„XLNeté¢„è®­ç»ƒæ¨¡å‹ï¼Œæ—¨åœ¨ä¸°å¯Œä¸­æ–‡è‡ªç„¶è¯­è¨€å¤„ç†èµ„æºï¼Œæä¾›å¤šå…ƒåŒ–çš„ä¸­æ–‡é¢„è®­ç»ƒæ¨¡å‹é€‰æ‹©ã€‚
æˆ‘ä»¬æ¬¢è¿å„ä½ä¸“å®¶å­¦è€…ä¸‹è½½ä½¿ç”¨ï¼Œå¹¶å…±åŒä¿ƒè¿›å’Œå‘å±•ä¸­æ–‡èµ„æºå»ºè®¾ã€‚

æœ¬é¡¹ç›®åŸºäºCMU/è°·æ­Œå®˜æ–¹çš„XLNetï¼šhttps://github.com/zihangdai/xlnet

----

[ä¸­æ–‡MacBERT](https://github.com/ymcui/MacBERT) | [ä¸­æ–‡ELECTRA](https://github.com/ymcui/Chinese-ELECTRA) | [ä¸­æ–‡XLNet](https://github.com/ymcui/Chinese-XLNet) | [çŸ¥è¯†è’¸é¦å·¥å…·TextBrewer](https://github.com/airaria/TextBrewer) | [æ¨¡å‹è£å‰ªå·¥å…·TextPruner](https://github.com/airaria/TextPruner)

æŸ¥çœ‹æ›´å¤šå“ˆå·¥å¤§è®¯é£è”åˆå®éªŒå®¤ï¼ˆHFLï¼‰å‘å¸ƒçš„èµ„æºï¼šhttps://github.com/ymcui/HFL-Anthology

## æ–°é—»
**2022/3/30 æˆ‘ä»¬å¼€æºäº†ä¸€ç§æ–°é¢„è®­ç»ƒæ¨¡å‹PERTã€‚æŸ¥çœ‹ï¼šhttps://github.com/ymcui/PERT**

2021/12/17 å“ˆå·¥å¤§è®¯é£è”åˆå®éªŒå®¤æ¨å‡ºæ¨¡å‹è£å‰ªå·¥å…·åŒ…TextPrunerã€‚æŸ¥çœ‹ï¼šhttps://github.com/airaria/TextPruner

2021/10/24 å“ˆå·¥å¤§è®¯é£è”åˆå®éªŒå®¤å‘å¸ƒé¢å‘å°‘æ•°æ°‘æ—è¯­è¨€çš„é¢„è®­ç»ƒæ¨¡å‹CINOã€‚æŸ¥çœ‹ï¼šhttps://github.com/ymcui/Chinese-Minority-PLM

2021/7/21 ç”±å“ˆå·¥å¤§SCIRå¤šä½å­¦è€…æ’°å†™çš„[ã€Šè‡ªç„¶è¯­è¨€å¤„ç†ï¼šåŸºäºé¢„è®­ç»ƒæ¨¡å‹çš„æ–¹æ³•ã€‹](https://item.jd.com/13344628.html)å·²å‡ºç‰ˆï¼Œæ¬¢è¿å¤§å®¶é€‰è´­ã€‚

2021/1/27 æ‰€æœ‰æ¨¡å‹å·²æ”¯æŒTensorFlow 2ï¼Œè¯·é€šè¿‡transformersåº“è¿›è¡Œè°ƒç”¨æˆ–ä¸‹è½½ã€‚https://huggingface.co/hfl

<details>
<summary>å†å²æ–°é—»</summary>
2020/9/15 æˆ‘ä»¬çš„è®ºæ–‡["Revisiting Pre-Trained Models for Chinese Natural Language Processing"](https://arxiv.org/abs/2004.13922)è¢«[Findings of EMNLP](https://2020.emnlp.org)å½•ç”¨ä¸ºé•¿æ–‡ã€‚

2020/8/27 å“ˆå·¥å¤§è®¯é£è”åˆå®éªŒå®¤åœ¨é€šç”¨è‡ªç„¶è¯­è¨€ç†è§£è¯„æµ‹GLUEä¸­è£ç™»æ¦œé¦–ï¼ŒæŸ¥çœ‹[GLUEæ¦œå•](https://gluebenchmark.com/leaderboard)ï¼Œ[æ–°é—»](http://dwz.date/ckrD)ã€‚

2020/3/11 ä¸ºäº†æ›´å¥½åœ°äº†è§£éœ€æ±‚ï¼Œé‚€è¯·æ‚¨å¡«å†™[è°ƒæŸ¥é—®å·](https://wj.qq.com/s2/5637766/6281)ï¼Œä»¥ä¾¿ä¸ºå¤§å®¶æä¾›æ›´å¥½çš„èµ„æºã€‚

2020/2/26 å“ˆå·¥å¤§è®¯é£è”åˆå®éªŒå®¤å‘å¸ƒ[çŸ¥è¯†è’¸é¦å·¥å…·TextBrewer](https://github.com/airaria/TextBrewer)

2019/12/19 æœ¬ç›®å½•å‘å¸ƒçš„æ¨¡å‹å·²æ¥å…¥[Huggingface-Transformers](https://github.com/huggingface/transformers)ï¼ŒæŸ¥çœ‹[å¿«é€ŸåŠ è½½](#å¿«é€ŸåŠ è½½)

2019/9/5 `XLNet-base`å·²å¯ä¸‹è½½ï¼ŒæŸ¥çœ‹[æ¨¡å‹ä¸‹è½½](#æ¨¡å‹ä¸‹è½½)

2019/8/19 æä¾›äº†åœ¨å¤§è§„æ¨¡é€šç”¨è¯­æ–™ï¼ˆ5.4Bè¯æ•°ï¼‰ä¸Šè®­ç»ƒçš„ä¸­æ–‡`XLNet-mid`æ¨¡å‹ï¼ŒæŸ¥çœ‹[æ¨¡å‹ä¸‹è½½](#æ¨¡å‹ä¸‹è½½)
</details>

## å†…å®¹å¯¼å¼•
| ç« èŠ‚ | æè¿° |
|-|-|
| [æ¨¡å‹ä¸‹è½½](#æ¨¡å‹ä¸‹è½½) | æä¾›äº†ä¸­æ–‡é¢„è®­ç»ƒXLNetä¸‹è½½åœ°å€ |
| [åŸºçº¿ç³»ç»Ÿæ•ˆæœ](#åŸºçº¿ç³»ç»Ÿæ•ˆæœ) | åˆ—ä¸¾äº†éƒ¨åˆ†åŸºçº¿ç³»ç»Ÿæ•ˆæœ |
| [é¢„è®­ç»ƒç»†èŠ‚](#é¢„è®­ç»ƒç»†èŠ‚) | é¢„è®­ç»ƒç»†èŠ‚çš„ç›¸å…³æè¿° |
| [ä¸‹æ¸¸ä»»åŠ¡å¾®è°ƒç»†èŠ‚](#ä¸‹æ¸¸ä»»åŠ¡å¾®è°ƒç»†èŠ‚) | ä¸‹æ¸¸ä»»åŠ¡å¾®è°ƒç»†èŠ‚çš„ç›¸å…³æè¿° |
| [FAQ](#faq) | å¸¸è§é—®é¢˜ç­”ç–‘ |
| [å¼•ç”¨](#å¼•ç”¨) | æœ¬ç›®å½•çš„æŠ€æœ¯æŠ¥å‘Š |

## æ¨¡å‹ä¸‹è½½
* **`XLNet-mid`**ï¼š24-layer, 768-hidden, 12-heads, 209M parameters
* **`XLNet-base`**ï¼š12-layer, 768-hidden, 12-heads, 117M parameters  

| æ¨¡å‹ç®€ç§° | è¯­æ–™ | Googleä¸‹è½½ | ç™¾åº¦ç½‘ç›˜ä¸‹è½½ |
| :------- | :--------- | :---------: | :---------: |
| **`XLNet-mid, Chinese`** | **ä¸­æ–‡ç»´åŸº+<br/>é€šç”¨æ•°æ®<sup>[1]</sup>** | **[TensorFlow](https://drive.google.com/open?id=1342uBc7ZmQwV6Hm6eUIN_OnBSz1LcvfA)** <br/>**[PyTorch](https://drive.google.com/open?id=1u-UmsJGy5wkXgbNK4w9uRnC0RxHLXhxy)** | **[TensorFlowï¼ˆå¯†ç 2jv2ï¼‰](https://pan.baidu.com/s/1bWEhc5gJ-ZMH6SO4m4GVyw?pwd=2jv2)** |
| **`XLNet-base, Chinese`** | **ä¸­æ–‡ç»´åŸº+<br/>é€šç”¨æ•°æ®<sup>[1]</sup>** | **[TensorFlow](https://drive.google.com/open?id=1m9t-a4gKimbkP5rqGXXsEAEPhJSZ8tvx)** <br/>**[PyTorch](https://drive.google.com/open?id=1mPDgcMfpqAf2wk9Nl8OaMj654pYrWXaR)** | **[TensorFlowï¼ˆå¯†ç ge7wï¼‰](https://pan.baidu.com/s/14KNb5KMvixKACEzgdd4Ntg?pwd=ge7w)** |

> [1] é€šç”¨æ•°æ®åŒ…æ‹¬ï¼šç™¾ç§‘ã€æ–°é—»ã€é—®ç­”ç­‰æ•°æ®ï¼Œæ€»è¯æ•°è¾¾5.4Bï¼Œä¸æˆ‘ä»¬å‘å¸ƒçš„[BERT-wwm-ext](https://github.com/ymcui/Chinese-BERT-wwm)è®­ç»ƒè¯­æ–™ç›¸åŒã€‚

### PyTorchç‰ˆæœ¬

å¦‚éœ€PyTorchç‰ˆæœ¬ï¼Œ

1ï¼‰è¯·è‡ªè¡Œé€šè¿‡[ğŸ¤—Transformers](https://github.com/huggingface/transformers)æä¾›çš„è½¬æ¢è„šæœ¬è¿›è¡Œè½¬æ¢ã€‚

2ï¼‰æˆ–è€…é€šè¿‡huggingfaceå®˜ç½‘ç›´æ¥ä¸‹è½½PyTorchç‰ˆæƒé‡ï¼šhttps://huggingface.co/hfl

æ–¹æ³•ï¼šç‚¹å‡»ä»»æ„éœ€è¦ä¸‹è½½çš„model â†’ æ‹‰åˆ°æœ€ä¸‹æ–¹ç‚¹å‡»"List all files in model" â†’ åœ¨å¼¹å‡ºçš„å°æ¡†ä¸­ä¸‹è½½binå’Œjsonæ–‡ä»¶ã€‚

### ä½¿ç”¨è¯´æ˜

ä¸­å›½å¤§é™†å¢ƒå†…å»ºè®®ä½¿ç”¨ç™¾åº¦ç½‘ç›˜ä¸‹è½½ç‚¹ï¼Œå¢ƒå¤–ç”¨æˆ·å»ºè®®ä½¿ç”¨è°·æ­Œä¸‹è½½ç‚¹ï¼Œ`XLNet-mid`æ¨¡å‹æ–‡ä»¶å¤§å°çº¦**800M**ã€‚ ä»¥TensorFlowç‰ˆ`XLNet-mid, Chinese`ä¸ºä¾‹ï¼Œä¸‹è½½å®Œæ¯•åå¯¹zipæ–‡ä»¶è¿›è¡Œè§£å‹å¾—åˆ°ï¼š

```
chinese_xlnet_mid_L-24_H-768_A-12.zip
    |- xlnet_model.ckpt      # æ¨¡å‹æƒé‡
    |- xlnet_model.meta      # æ¨¡å‹metaä¿¡æ¯
    |- xlnet_model.index     # æ¨¡å‹indexä¿¡æ¯
    |- xlnet_config.json     # æ¨¡å‹å‚æ•°
    |- spiece.model          # è¯è¡¨
```

### å¿«é€ŸåŠ è½½
ä¾æ‰˜äº[Huggingface-Transformers 2.2.2](https://github.com/huggingface/transformers)ï¼Œå¯è½»æ¾è°ƒç”¨ä»¥ä¸Šæ¨¡å‹ã€‚
```
tokenizer = AutoTokenizer.from_pretrained("MODEL_NAME")
model = AutoModel.from_pretrained("MODEL_NAME")
```
å…¶ä¸­`MODEL_NAME`å¯¹åº”åˆ—è¡¨å¦‚ä¸‹ï¼š  

| æ¨¡å‹å | MODEL_NAME |
| - | - |
| XLNet-mid | hfl/chinese-xlnet-mid |
| XLNet-base | hfl/chinese-xlnet-base |


## åŸºçº¿ç³»ç»Ÿæ•ˆæœ
ä¸ºäº†å¯¹æ¯”åŸºçº¿æ•ˆæœï¼Œæˆ‘ä»¬åœ¨ä»¥ä¸‹å‡ ä¸ªä¸­æ–‡æ•°æ®é›†ä¸Šè¿›è¡Œäº†æµ‹è¯•ã€‚å¯¹æ¯”äº†ä¸­æ–‡BERTã€BERT-wwmã€BERT-wwm-extä»¥åŠXLNet-baseã€XLNet-midã€‚
å…¶ä¸­ä¸­æ–‡BERTã€BERT-wwmã€BERT-wwm-extç»“æœå–è‡ª[ä¸­æ–‡BERT-wwmé¡¹ç›®](https://github.com/ymcui/Chinese-BERT-wwm)ã€‚
æ—¶é—´åŠç²¾åŠ›æœ‰é™ï¼Œå¹¶æœªèƒ½è¦†ç›–æ›´å¤šç±»åˆ«çš„ä»»åŠ¡ï¼Œè¯·å¤§å®¶è‡ªè¡Œå°è¯•ã€‚

**æ³¨æ„ï¼šä¸ºäº†ä¿è¯ç»“æœçš„å¯é æ€§ï¼Œå¯¹äºåŒä¸€æ¨¡å‹ï¼Œæˆ‘ä»¬è¿è¡Œ10éï¼ˆä¸åŒéšæœºç§å­ï¼‰ï¼Œæ±‡æŠ¥æ¨¡å‹æ€§èƒ½çš„æœ€å¤§å€¼å’Œå¹³å‡å€¼ã€‚ä¸å‡ºæ„å¤–ï¼Œä½ è¿è¡Œçš„ç»“æœåº”è¯¥å¾ˆå¤§æ¦‚ç‡è½åœ¨è¿™ä¸ªåŒºé—´å†…ã€‚**

**è¯„æµ‹æŒ‡æ ‡ä¸­ï¼Œæ‹¬å·å†…è¡¨ç¤ºå¹³å‡å€¼ï¼Œæ‹¬å·å¤–è¡¨ç¤ºæœ€å¤§å€¼ã€‚**

### ç®€ä½“ä¸­æ–‡é˜…è¯»ç†è§£ï¼šCMRC 2018
**[CMRC 2018æ•°æ®é›†](https://github.com/ymcui/cmrc2018)**æ˜¯å“ˆå·¥å¤§è®¯é£è”åˆå®éªŒå®¤å‘å¸ƒçš„ä¸­æ–‡æœºå™¨é˜…è¯»ç†è§£æ•°æ®ã€‚
æ ¹æ®ç»™å®šé—®é¢˜ï¼Œç³»ç»Ÿéœ€è¦ä»ç¯‡ç« ä¸­æŠ½å–å‡ºç‰‡æ®µä½œä¸ºç­”æ¡ˆï¼Œå½¢å¼ä¸SQuADç›¸åŒã€‚
è¯„æµ‹æŒ‡æ ‡ä¸ºï¼šEM / F1

| æ¨¡å‹ | å¼€å‘é›† | æµ‹è¯•é›† | æŒ‘æˆ˜é›† |
| :------- | :---------: | :---------: | :---------: |
| BERT | 65.5 (64.4) / 84.5 (84.0) | 70.0 (68.7) / 87.0 (86.3) | 18.6 (17.0) / 43.3 (41.3) |
| BERT-wwm | 66.3 (65.0) / 85.6 (84.7) | 70.5 (69.1) / 87.4 (86.7) | 21.0 (19.3) / 47.0 (43.9) |
| BERT-wwm-ext | **67.1** (65.6) / 85.7 (85.0) | **71.4 (70.0)** / 87.7 (87.0) | 24.0 (20.0) / 47.3 (44.6) |
| **XLNet-base** | 65.2 (63.0) / 86.9  (85.9) | 67.0 (65.8) / 87.2 (86.8) | 25.0 (22.7) / 51.3 (49.5) |
| **XLNet-mid** | 66.8 **(66.3) / 88.4 (88.1)** | 69.3 (68.5) / **89.2 (88.8)** | **29.1 (27.1) / 55.8 (54.9)** |


### ç¹ä½“ä¸­æ–‡é˜…è¯»ç†è§£ï¼šDRCD
**[DRCDæ•°æ®é›†](https://github.com/DRCKnowledgeTeam/DRCD)**ç”±ä¸­å›½å°æ¹¾å°è¾¾ç ”ç©¶é™¢å‘å¸ƒï¼Œå…¶å½¢å¼ä¸SQuADç›¸åŒï¼Œæ˜¯åŸºäºç¹ä½“ä¸­æ–‡çš„æŠ½å–å¼é˜…è¯»ç†è§£æ•°æ®é›†ã€‚
è¯„æµ‹æŒ‡æ ‡ä¸ºï¼šEM / F1

| æ¨¡å‹ | å¼€å‘é›† | æµ‹è¯•é›† |
| :------- | :---------: | :---------: |
| BERT | 83.1 (82.7) / 89.9 (89.6) | 82.2 (81.6) / 89.2 (88.8) |
| BERT-wwm | 84.3 (83.4) / 90.5 (90.2) | 82.8 (81.8) / 89.7 (89.0) |
| BERT-wwm-ext | 85.0 (84.5) / 91.2 (90.9) | 83.6 (83.0) / 90.4 (89.9) |
| **XLNet-base** | 83.8 (83.2) / 92.3 (92.0) | 83.5 (82.8) / 92.2 (91.8) |
| **XLNet-mid** | **85.3 (84.9) / 93.5 (93.3)** | **85.5 (84.8) / 93.6 (93.2)** |

### æƒ…æ„Ÿåˆ†ç±»ï¼šChnSentiCorp
åœ¨æƒ…æ„Ÿåˆ†ç±»ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ChnSentiCorpæ•°æ®é›†ã€‚æ¨¡å‹éœ€è¦å°†æ–‡æœ¬åˆ†æˆ`ç§¯æ`, `æ¶ˆæ`ä¸¤ä¸ªç±»åˆ«ã€‚
è¯„æµ‹æŒ‡æ ‡ä¸ºï¼šAccuracy

| æ¨¡å‹ | å¼€å‘é›† | æµ‹è¯•é›† |
| :------- | :---------: | :---------: |
| BERT | 94.7 (94.3) | 95.0 (94.7) |
| BERT-wwm | 95.1 (94.5) | **95.4 (95.0)** |
| **XLNet-base** | | |
| **XLNet-mid** | **95.8 (95.2)** | **95.4** (94.9) |

## é¢„è®­ç»ƒç»†èŠ‚
ä»¥ä¸‹ä»¥`XLNet-mid`æ¨¡å‹ä¸ºä¾‹ï¼Œå¯¹é¢„è®­ç»ƒç»†èŠ‚è¿›è¡Œè¯´æ˜ã€‚

### ç”Ÿæˆè¯è¡¨
æŒ‰ç…§XLNetå®˜æ–¹æ•™ç¨‹æ­¥éª¤ï¼Œé¦–å…ˆéœ€è¦ä½¿ç”¨[Sentence Piece](https://github.com/google/sentencepiece)ç”Ÿæˆè¯è¡¨ã€‚
åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„è¯è¡¨å¤§å°ä¸º32000ï¼Œå…¶ä½™å‚æ•°é‡‡ç”¨å®˜æ–¹ç¤ºä¾‹ä¸­çš„é»˜è®¤é…ç½®ã€‚

```
spm_train \
	--input=wiki.zh.txt \
	--model_prefix=sp10m.cased.v3 \
	--vocab_size=32000 \
	--character_coverage=0.99995 \
	--model_type=unigram \
	--control_symbols=\<cls\>,\<sep\>,\<pad\>,\<mask\>,\<eod\> \
	--user_defined_symbols=\<eop\>,.,\(,\),\",-,â€“,Â£,â‚¬ \
	--shuffle_input_sentence \
	--input_sentence_size=10000000
```

### ç”Ÿæˆtf_records
ç”Ÿæˆè¯è¡¨åï¼Œå¼€å§‹åˆ©ç”¨åŸå§‹æ–‡æœ¬è¯­æ–™ç”Ÿæˆè®­ç»ƒç”¨çš„tf_recordsæ–‡ä»¶ã€‚
åŸå§‹æ–‡æœ¬çš„æ„é€ æ–¹å¼ä¸åŸæ•™ç¨‹ç›¸åŒï¼š
- æ¯è¡Œéƒ½æ˜¯ä¸€ä¸ªå¥å­
- ç©ºè¡Œä»£è¡¨æ–‡æ¡£æœ«å°¾

ä»¥ä¸‹æ˜¯ç”Ÿæˆæ•°æ®æ—¶çš„å‘½ä»¤ï¼ˆ`num_task`ä¸`task`è¯·æ ¹æ®å®é™…åˆ‡ç‰‡æ•°é‡è¿›è¡Œè®¾ç½®ï¼‰ï¼š
```
SAVE_DIR=./output_b32
INPUT=./data/*.proc.txt

python data_utils.py \
	--bsz_per_host=32 \
	--num_core_per_host=8 \
	--seq_len=512 \
	--reuse_len=256 \
	--input_glob=${INPUT} \
	--save_dir=${SAVE_DIR} \
	--num_passes=20 \
	--bi_data=True \
	--sp_path=spiece.model \
	--mask_alpha=6 \
	--mask_beta=1 \
	--num_predict=85 \
	--uncased=False \
	--num_task=10 \
	--task=1
```

### é¢„è®­ç»ƒ
è·å¾—ä»¥ä¸Šæ•°æ®åï¼Œæ­£å¼å¼€å§‹é¢„è®­ç»ƒXLNetã€‚
ä¹‹æ‰€ä»¥å«`XLNet-mid`æ˜¯å› ä¸ºä»…ç›¸æ¯”`XLNet-base`å¢åŠ äº†å±‚æ•°ï¼ˆ12å±‚å¢åŠ åˆ°24å±‚ï¼‰ï¼Œå…¶ä½™å‚æ•°æ²¡æœ‰å˜åŠ¨ï¼Œä¸»è¦å› ä¸ºè®¡ç®—è®¾å¤‡å—é™ã€‚
ä½¿ç”¨çš„å‘½ä»¤å¦‚ä¸‹ï¼š
```
DATA=YOUR_GS_BUCKET_PATH_TO_TFRECORDS
MODEL_DIR=YOUR_OUTPUT_MODEL_PATH
TPU_NAME=v3-xlnet
TPU_ZONE=us-central1-b

python train.py \
	--record_info_dir=$DATA \
	--model_dir=$MODEL_DIR \
	--train_batch_size=32 \
	--seq_len=512 \
	--reuse_len=256 \
	--mem_len=384 \
	--perm_size=256 \
	--n_layer=24 \
	--d_model=768 \
	--d_embed=768 \
	--n_head=12 \
	--d_head=64 \
	--d_inner=3072 \
	--untie_r=True \
	--mask_alpha=6 \
	--mask_beta=1 \
	--num_predict=85 \
	--uncased=False \
	--train_steps=2000000 \
	--save_steps=20000 \
	--warmup_steps=20000 \
	--max_save=20 \
	--weight_decay=0.01 \
	--adam_epsilon=1e-6 \
	--learning_rate=1e-4 \
	--dropout=0.1 \
	--dropatt=0.1 \
	--tpu=$TPU_NAME \
	--tpu_zone=$TPU_ZONE \
	--use_tpu=True
```

## ä¸‹æ¸¸ä»»åŠ¡å¾®è°ƒç»†èŠ‚
ä¸‹æ¸¸ä»»åŠ¡å¾®è°ƒä½¿ç”¨çš„è®¾å¤‡æ˜¯è°·æ­ŒCloud TPU v2ï¼ˆ64G HBMï¼‰ï¼Œä»¥ä¸‹ç®€è¦è¯´æ˜å„ä»»åŠ¡ç²¾è°ƒæ—¶çš„é…ç½®ã€‚
å¦‚æœä½ ä½¿ç”¨GPUè¿›è¡Œç²¾è°ƒï¼Œè¯·æ›´æ”¹ç›¸åº”å‚æ•°ä»¥é€‚é…ï¼Œå°¤å…¶æ˜¯`batch_size`, `learning_rate`ç­‰å‚æ•°ã€‚
**ç›¸å…³ä»£ç è¯·æŸ¥çœ‹`src`ç›®å½•ã€‚**

### CMRC 2018
å¯¹äºé˜…è¯»ç†è§£ä»»åŠ¡ï¼Œé¦–å…ˆéœ€è¦ç”Ÿæˆtf_recordsæ•°æ®ã€‚
è¯·å‚è€ƒXLNetå®˜æ–¹æ•™ç¨‹ä¹‹[SQuAD 2.0å¤„ç†æ–¹æ³•](https://github.com/zihangdai/xlnet#squad20)ï¼Œåœ¨è¿™é‡Œä¸å†èµ˜è¿°ã€‚
ä»¥ä¸‹æ˜¯CMRC 2018ä¸­æ–‡æœºå™¨é˜…è¯»ç†è§£ä»»åŠ¡ä¸­ä½¿ç”¨çš„è„šæœ¬å‚æ•°ï¼š
```
XLNET_DIR=YOUR_GS_BUCKET_PATH_TO_XLNET
MODEL_DIR=YOUR_OUTPUT_MODEL_PATH
DATA_DIR=YOUR_DATA_DIR_TO_TFRECORDS
RAW_DIR=YOUR_RAW_DATA_DIR
TPU_NAME=v2-xlnet
TPU_ZONE=us-central1-b

python -u run_cmrc_drcd.py \
	--spiece_model_file=./spiece.model \
	--model_config_path=${XLNET_DIR}/xlnet_config.json \
	--init_checkpoint=${XLNET_DIR}/xlnet_model.ckpt \
	--tpu_zone=${TPU_ZONE} \
	--use_tpu=True \
	--tpu=${TPU_NAME} \
	--num_hosts=1 \
	--num_core_per_host=8 \
	--output_dir=${DATA_DIR} \
	--model_dir=${MODEL_DIR} \
	--predict_dir=${MODEL_DIR}/eval \
	--train_file=${DATA_DIR}/cmrc2018_train.json \
	--predict_file=${DATA_DIR}/cmrc2018_dev.json \
	--uncased=False \
	--max_answer_length=40 \
	--max_seq_length=512 \
	--do_train=True \
	--train_batch_size=16 \
	--do_predict=True \
	--predict_batch_size=16 \
	--learning_rate=3e-5 \
	--adam_epsilon=1e-6 \
	--iterations=1000 \
	--save_steps=2000 \
	--train_steps=2400 \
	--warmup_steps=240
```

### DRCD
ä»¥ä¸‹æ˜¯DRCDç¹ä½“ä¸­æ–‡æœºå™¨é˜…è¯»ç†è§£ä»»åŠ¡ä¸­ä½¿ç”¨çš„è„šæœ¬å‚æ•°ï¼š
```
XLNET_DIR=YOUR_GS_BUCKET_PATH_TO_XLNET
MODEL_DIR=YOUR_OUTPUT_MODEL_PATH
DATA_DIR=YOUR_DATA_DIR_TO_TFRECORDS
RAW_DIR=YOUR_RAW_DATA_DIR
TPU_NAME=v2-xlnet
TPU_ZONE=us-central1-b

python -u run_cmrc_drcd.py \
	--spiece_model_file=./spiece.model \
	--model_config_path=${XLNET_DIR}/xlnet_config.json \
	--init_checkpoint=${XLNET_DIR}/xlnet_model.ckpt \
	--tpu_zone=${TPU_ZONE} \
	--use_tpu=True \
	--tpu=${TPU_NAME} \
	--num_hosts=1 \
	--num_core_per_host=8 \
	--output_dir=${DATA_DIR} \
	--model_dir=${MODEL_DIR} \
	--predict_dir=${MODEL_DIR}/eval \
	--train_file=${DATA_DIR}/DRCD_training.json \
	--predict_file=${DATA_DIR}/DRCD_dev.json \
	--uncased=False \
	--max_answer_length=30 \
	--max_seq_length=512 \
	--do_train=True \
	--train_batch_size=16 \
	--do_predict=True \
	--predict_batch_size=16 \
	--learning_rate=3e-5 \
	--adam_epsilon=1e-6 \
	--iterations=1000 \
	--save_steps=2000 \
	--train_steps=3600 \
	--warmup_steps=360
```

### ChnSentiCorp
ä¸é˜…è¯»ç†è§£ä»»åŠ¡ä¸åŒï¼Œåˆ†ç±»ä»»åŠ¡æ— éœ€æå‰ç”Ÿæˆtf_recordsã€‚
ä»¥ä¸‹æ˜¯ChnSentiCorpæƒ…æ„Ÿåˆ†ç±»ä»»åŠ¡ä¸­ä½¿ç”¨çš„è„šæœ¬å‚æ•°ï¼š
```
XLNET_DIR=YOUR_GS_BUCKET_PATH_TO_XLNET
MODEL_DIR=YOUR_OUTPUT_MODEL_PATH
DATA_DIR=YOUR_DATA_DIR_TO_TFRECORDS
RAW_DIR=YOUR_RAW_DATA_DIR
TPU_NAME=v2-xlnet
TPU_ZONE=us-central1-b

python -u run_classifier.py \
	--spiece_model_file=./spiece.model \
	--model_config_path=${XLNET_DIR}/xlnet_config.json \
	--init_checkpoint=${XLNET_DIR}/xlnet_model.ckpt \
	--task_name=csc \
	--do_train=True \
	--do_eval=True \
	--eval_all_ckpt=False \
	--uncased=False \
	--data_dir=${RAW_DIR} \
	--output_dir=${DATA_DIR} \
	--model_dir=${MODEL_DIR} \
	--train_batch_size=48 \
	--eval_batch_size=48 \
	--num_hosts=1 \
	--num_core_per_host=8 \
	--num_train_epochs=3 \
	--max_seq_length=256 \
	--learning_rate=2e-5 \
	--save_steps=5000 \
	--use_tpu=True \
	--tpu=${TPU_NAME} \
	--tpu_zone=${TPU_ZONE}
```

## FAQ
**Q: ä¼šå‘å¸ƒæ›´å¤§çš„æ¨¡å‹å—ï¼Ÿ**  
A: ä¸ä¸€å®šï¼Œä¸ä¿è¯ã€‚å¦‚æœæˆ‘ä»¬è·å¾—äº†æ˜¾è‘—æ€§èƒ½æå‡ï¼Œä¼šè€ƒè™‘å‘å¸ƒå‡ºæ¥ã€‚

**Q: åœ¨æŸäº›æ•°æ®é›†ä¸Šæ•ˆæœä¸å¥½ï¼Ÿ**  
A: é€‰ç”¨å…¶ä»–æ¨¡å‹æˆ–è€…åœ¨è¿™ä¸ªcheckpointä¸Šç»§ç»­ç”¨ä½ çš„æ•°æ®åšé¢„è®­ç»ƒã€‚

**Q: é¢„è®­ç»ƒæ•°æ®ä¼šå‘å¸ƒå—ï¼Ÿ**  
A: æŠ±æ­‰ï¼Œå› ä¸ºç‰ˆæƒé—®é¢˜æ— æ³•å‘å¸ƒã€‚

**Q: è®­ç»ƒXLNetèŠ±äº†å¤šé•¿æ—¶é—´ï¼Ÿ**  
A: `XLNet-mid`ä½¿ç”¨äº†Cloud TPU v3 (128G HBM)è®­ç»ƒäº†2M stepsï¼ˆbatch=32ï¼‰ï¼Œå¤§çº¦éœ€è¦3å‘¨æ—¶é—´ã€‚`XLNet-base`åˆ™æ˜¯è®­ç»ƒäº†4M stepsã€‚

**Q: ä¸ºä»€ä¹ˆXLNetå®˜æ–¹æ²¡æœ‰å‘å¸ƒMultilingualæˆ–è€…Chinese XLNetï¼Ÿ**  
A: 
ï¼ˆä»¥ä¸‹æ˜¯ä¸ªäººçœ‹æ³•ï¼‰ä¸å¾—è€ŒçŸ¥ï¼Œå¾ˆå¤šäººç•™è¨€è¡¨ç¤ºå¸Œæœ›æœ‰ï¼Œæˆ³[XLNet-issue-#3](https://github.com/zihangdai/xlnet/issues/3)ã€‚
ä»¥XLNetå®˜æ–¹çš„æŠ€æœ¯å’Œç®—åŠ›æ¥è¯´ï¼Œè®­ç»ƒä¸€ä¸ªè¿™æ ·çš„æ¨¡å‹å¹¶ééš¾äº‹ï¼ˆmultilingualç‰ˆå¯èƒ½æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦è€ƒè™‘å„è¯­ç§ä¹‹é—´çš„å¹³è¡¡ï¼Œä¹Ÿå¯ä»¥å‚è€ƒ[multilingual-bert](https://github.com/google-research/bert/blob/master/multilingual.md)ä¸­çš„æè¿°ã€‚ï¼‰ã€‚ 
**ä¸è¿‡åè¿‡æ¥æƒ³ä¸€ä¸‹ï¼Œä½œè€…ä»¬ä¹Ÿå¹¶æ²¡æœ‰ä¹‰åŠ¡ä¸€å®šè¦è¿™ä¹ˆåšã€‚** 
ä½œä¸ºå­¦è€…æ¥è¯´ï¼Œä»–ä»¬çš„technical contributionå·²ç»è¶³å¤Ÿï¼Œä¸å‘å¸ƒå‡ºæ¥ä¹Ÿä¸åº”å—åˆ°æŒ‡è´£ï¼Œå‘¼åå¤§å®¶ç†æ€§å¯¹å¾…åˆ«äººçš„å·¥ä½œã€‚

**Q: XLNetå¤šæ•°æƒ…å†µä¸‹æ¯”BERTè¦å¥½å—ï¼Ÿ**  
A: ç›®å‰çœ‹æ¥è‡³å°‘ä¸Šè¿°å‡ ä¸ªä»»åŠ¡æ•ˆæœéƒ½è¿˜ä¸é”™ï¼Œä½¿ç”¨çš„æ•°æ®å’Œæˆ‘ä»¬å‘å¸ƒçš„[BERT-wwm-ext](https://github.com/ymcui/Chinese-BERT-wwm)æ˜¯ä¸€æ ·çš„ã€‚

**Q: ï¼Ÿ**  
A: ã€‚


## å¼•ç”¨
å¦‚æœæœ¬ç›®å½•ä¸­çš„å†…å®¹å¯¹ä½ çš„ç ”ç©¶å·¥ä½œæœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿åœ¨è®ºæ–‡ä¸­å¼•ç”¨ä¸‹è¿°æŠ€æœ¯æŠ¥å‘Šï¼š
https://arxiv.org/abs/2004.13922
```
@inproceedings{cui-etal-2020-revisiting,
    title = "Revisiting Pre-Trained Models for {C}hinese Natural Language Processing",
    author = "Cui, Yiming  and
      Che, Wanxiang  and
      Liu, Ting  and
      Qin, Bing  and
      Wang, Shijin  and
      Hu, Guoping",
    booktitle = "Proceedings of the 2020 Conference on Empirical Methods in Natural Language Processing: Findings",
    month = nov,
    year = "2020",
    address = "Online",
    publisher = "Association for Computational Linguistics",
    url = "https://www.aclweb.org/anthology/2020.findings-emnlp.58",
    pages = "657--668",
}
```


## è‡´è°¢
é¡¹ç›®ä½œè€…ï¼š å´”ä¸€é¸£ï¼ˆå“ˆå·¥å¤§è®¯é£è”åˆå®éªŒå®¤ï¼‰ã€è½¦ä¸‡ç¿”ï¼ˆå“ˆå·¥å¤§ï¼‰ã€åˆ˜æŒºï¼ˆå“ˆå·¥å¤§ï¼‰ã€ç‹å£«è¿›ï¼ˆç§‘å¤§è®¯é£ï¼‰ã€èƒ¡å›½å¹³ï¼ˆç§‘å¤§è®¯é£ï¼‰  

æœ¬é¡¹ç›®å—åˆ°è°·æ­Œ[TensorFlow Research Cloud (TFRC)](https://www.tensorflow.org/tfrc)è®¡åˆ’èµ„åŠ©ã€‚

å»ºè®¾è¯¥é¡¹ç›®è¿‡ç¨‹ä¸­å‚è€ƒäº†å¦‚ä¸‹ä»“åº“ï¼Œåœ¨è¿™é‡Œè¡¨ç¤ºæ„Ÿè°¢ï¼š
- XLNet: https://github.com/zihangdai/xlnet
- Malaya: https://github.com/huseinzol05/Malaya/tree/master/xlnet
- Korean XLNetï¼ˆéŸ©æ–‡æè¿°ï¼Œæ— ç¿»è¯‘ï¼‰: https://github.com/yeontaek/XLNET-Korean-Model


## å…è´£å£°æ˜
æœ¬é¡¹ç›®å¹¶é[XLNetå®˜æ–¹](https://github.com/zihangdai/xlnet)å‘å¸ƒçš„Chinese XLNetæ¨¡å‹ã€‚
åŒæ—¶ï¼Œæœ¬é¡¹ç›®ä¸æ˜¯å“ˆå·¥å¤§æˆ–ç§‘å¤§è®¯é£çš„å®˜æ–¹äº§å“ã€‚
è¯¥é¡¹ç›®ä¸­çš„å†…å®¹ä»…ä¾›æŠ€æœ¯ç ”ç©¶å‚è€ƒï¼Œä¸ä½œä¸ºä»»ä½•ç»“è®ºæ€§ä¾æ®ã€‚
ä½¿ç”¨è€…å¯ä»¥åœ¨è®¸å¯è¯èŒƒå›´å†…ä»»æ„ä½¿ç”¨è¯¥æ¨¡å‹ï¼Œä½†æˆ‘ä»¬ä¸å¯¹å› ä½¿ç”¨è¯¥é¡¹ç›®å†…å®¹é€ æˆçš„ç›´æ¥æˆ–é—´æ¥æŸå¤±è´Ÿè´£ã€‚


## å…³æ³¨æˆ‘ä»¬
æ¬¢è¿å…³æ³¨å“ˆå·¥å¤§è®¯é£è”åˆå®éªŒå®¤å®˜æ–¹å¾®ä¿¡å…¬ä¼—å·ã€‚

![qrcode.png](https://github.com/ymcui/cmrc2019/raw/master/qrcode.jpg)


## é—®é¢˜åé¦ˆ & è´¡çŒ®
å¦‚æœ‰é—®é¢˜ï¼Œè¯·åœ¨GitHub Issueä¸­æäº¤ã€‚  
æˆ‘ä»¬æ²¡æœ‰è¿è¥ï¼Œé¼“åŠ±ç½‘å‹äº’ç›¸å¸®åŠ©è§£å†³é—®é¢˜ã€‚  
å¦‚æœå‘ç°å®ç°ä¸Šçš„é—®é¢˜æˆ–æ„¿æ„å…±åŒå»ºè®¾è¯¥é¡¹ç›®ï¼Œè¯·æäº¤Pull Requestã€‚  

